---
layout: handbook_template_bs
---

<h1 class="hb-chapter-title">{{ page.title }}</h1>

<article id="hb-content-{{ page.slug }}" class="hb-chapter-body">
    {{ page.content }}
</article>

<hr>
<footer class="hb-chapter-footer">
    Last updated: {{ page.last_updated }}
</footer>

<script>
$(function(){

    var $collapseTargetParent = $('#hb-content-{{ page.slug }}');
    var validHeadingTags = ['h1', 'h2', 'h3'];

    // Groupify everything into heading+content pairs then
    // Run el collapso https://github.com/danielstocks/jQuery-Collapse

    insanityGrouping($collapseTargetParent, validHeadingTags);

    $collapseTargetParent.collapse({
        query: validheadingTags.join(', '),
        persist: true,
        open: function(){
            this.slideDown(100);
        },
        close: function(){
            this.slideUp(100);
        }
    });

    //====================

    /**
     * Implements a grouping spec as per what our collapse plugin expects:
     * https://github.com/danielstocks/jQuery-Collapse#usage
     * 
     * @param jQuery element
     */
    function insanityGrouping($elem, headingTagNames){
        
        if (!$elem) throw 'No jQuery element was provided in argument 1';
        headingTagNames = headingTagNames || ['h1', 'h2'];

        var $shadow = $('<div>');
        var $subcontent = $('<div>');
        $elem.children().each(function(){
            var $this = $(this);
            var tagName = $this.prop('tagName').toLowerCase();
            if (~headingTagNames.indexOf(tagName)){
                // Wrap up the old one, push it into shadow.
                $subcontent.clone().appendTo($shadow);
                $this.clone().appendTo($shadow);
                $subcontent = $('<div>');
            }
            else {
                $this.appendTo($subcontent);
            }
        });
        if ($subcontent){
            $subcontent.clone().appendTo($shadow);
        }
        // Switcharoo
        $elem.empty();
        $shadow.children().appendTo($elem);
        delete $shadow;
    }

});
</script>